// ----------------------------------------------------------------------------
// Buzz, a Javascript HTML5 Audio library
// v 1.0.4 beta
// Licensed under the MIT license.
// http://buzz.jaysalvat.com/
// ----------------------------------------------------------------------------
// Copyright (C) 2011 Jay Salvat
// http://jaysalvat.com/
// ----------------------------------------------------------------------------
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files ( the "Software" ), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
// ----------------------------------------------------------------------------

var buzz={defaults:{autoplay:!1,duration:5e3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(src,options){function timerangeToArray(timeRange){var array=[],length=timeRange.length-1;for(var i=0;i<=length;i++)array.push({start:timeRange.start(length),end:timeRange.end(length)});return array}function getExt(filename){return filename.split(".").pop()}function addSource(sound,src){var source=document.createElement("source");source.src=src,buzz.types[getExt(src)]&&(source.type=buzz.types[getExt(src)]),sound.appendChild(source)}options=options||{};var pid=0,events=[],eventsOnce={},supported=buzz.isSupported();this.load=function(){return supported?(this.sound.load(),this):this},this.play=function(){return supported?(this.sound.play(),this):this},this.togglePlay=function(){return supported?(this.sound.paused?this.sound.play():this.sound.pause(),this):this},this.pause=function(){return supported?(this.sound.pause(),this):this},this.isPaused=function(){return supported?this.sound.paused:null},this.stop=function(){return supported?(this.setTime(this.getDuration()),this.sound.pause(),this):this},this.isEnded=function(){return supported?this.sound.ended:null},this.loop=function(){return supported?(this.sound.loop="loop",this.bind("ended.buzzloop",function(){this.currentTime=0,this.play()}),this):this},this.unloop=function(){return supported?(this.sound.removeAttribute("loop"),this.unbind("ended.buzzloop"),this):this},this.mute=function(){return supported?(this.sound.muted=!0,this):this},this.unmute=function(){return supported?(this.sound.muted=!1,this):this},this.toggleMute=function(){return supported?(this.sound.muted=!this.sound.muted,this):this},this.isMuted=function(){return supported?this.sound.muted:null},this.setVolume=function(volume){return supported?(volume<0&&(volume=0),volume>100&&(volume=100),this.volume=volume,this.sound.volume=volume/100,this):this},this.getVolume=function(){return supported?this.volume:this},this.increaseVolume=function(value){return this.setVolume(this.volume+(value||1))},this.decreaseVolume=function(value){return this.setVolume(this.volume-(value||1))},this.setTime=function(time){return supported?(this.whenReady(function(){this.sound.currentTime=time}),this):this},this.getTime=function(){if(!supported)return null;var time=Math.round(this.sound.currentTime*100)/100;return isNaN(time)?buzz.defaults.placeholder:time},this.setPercent=function(percent){return supported?this.setTime(buzz.fromPercent(percent,this.sound.duration)):this},this.getPercent=function(){if(!supported)return null;var percent=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(percent)?buzz.defaults.placeholder:percent},this.setSpeed=function(duration){if(!supported)return this;this.sound.playbackRate=duration},this.getSpeed=function(){return supported?this.sound.playbackRate:null},this.getDuration=function(){if(!supported)return null;var duration=Math.round(this.sound.duration*100)/100;return isNaN(duration)?buzz.defaults.placeholder:duration},this.getPlayed=function(){return supported?timerangeToArray(this.sound.played):null},this.getBuffered=function(){return supported?timerangeToArray(this.sound.buffered):null},this.getSeekable=function(){return supported?timerangeToArray(this.sound.seekable):null},this.getErrorCode=function(){return supported&&this.sound.error?this.sound.error.code:0},this.getErrorMessage=function(){if(!supported)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}},this.getStateCode=function(){return supported?this.sound.readyState:null},this.getStateMessage=function(){if(!supported)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}},this.getNetworkStateCode=function(){return supported?this.sound.networkState:null},this.getNetworkStateMessage=function(){if(!supported)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}},this.set=function(key,value){return supported?(this.sound[key]=value,this):this},this.get=function(key){return supported?key?this.sound[key]:this.sound:null},this.bind=function(types,func){if(!supported)return this;types=types.split(" ");var that=this,efunc=function(e){func.call(that,e)};for(var t=0;t<types.length;t++){var type=types[t],idx=type;type=idx.split(".")[0],events.push({idx:idx,func:efunc}),this.sound.addEventListener(type,efunc,!0)}return this},this.unbind=function(types){if(!supported)return this;types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t],type=idx.split(".")[0];for(var i=0;i<events.length;i++){var namespace=events[i].idx.split(".");if(events[i].idx==idx||namespace[1]&&namespace[1]==idx.replace(".",""))this.sound.removeEventListener(type,events[i].func,!0),delete events[i]}}return this},this.bindOnce=function(type,func){if(!supported)return this;var that=this;eventsOnce[pid++]=!1,this.bind(pid+type,function(){eventsOnce[pid]||(eventsOnce[pid]=!0,func.call(that)),that.unbind(pid+type)})},this.trigger=function(types){if(!supported)return this;types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t];for(var i=0;i<events.length;i++){var eventType=events[i].idx.split(".");if(events[i].idx==idx||eventType[0]&&eventType[0]==idx.replace(".","")){var evt=document.createEvent("HTMLEvents");evt.initEvent(eventType[0],!1,!0),this.sound.dispatchEvent(evt)}}}return this},this.fadeTo=function(to,duration,callback){function doFade(){setTimeout(function(){from<to&&that.volume<to?(that.setVolume(that.volume+=1),doFade()):from>to&&that.volume>to?(that.setVolume(that.volume-=1),doFade()):callback instanceof Function&&callback.apply(that)},delay)}if(!supported)return this;duration instanceof Function?(callback=duration,duration=buzz.defaults.duration):duration=duration||buzz.defaults.duration;var from=this.volume,delay=duration/Math.abs(from-to),that=this;return this.play(),this.whenReady(function(){doFade()}),this},this.fadeIn=function(duration,callback){return supported?this.setVolume(0).fadeTo(100,duration,callback):this},this.fadeOut=function(duration,callback){return supported?this.fadeTo(0,duration,callback):this},this.fadeWith=function(sound,duration){return supported?(this.fadeOut(duration,function(){this.stop()}),sound.play().fadeIn(duration),this):this},this.whenReady=function(func){if(!supported)return null;var that=this;this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){func.call(that)}):func.call(that)};if(supported){for(var i in buzz.defaults)buzz.defaults.hasOwnProperty(i)&&(options[i]=options[i]||buzz.defaults[i]);this.sound=document.createElement("audio");if(src instanceof Array)for(var j in src)src.hasOwnProperty(j)&&addSource(this.sound,src[j]);else if(options.formats.length)for(var k in options.formats)options.formats.hasOwnProperty(k)&&addSource(this.sound,src+"."+options.formats[k]);else addSource(this.sound,src);options.loop&&this.loop(),options.autoplay&&(this.sound.autoplay="autoplay"),options.preload===!0?this.sound.preload="auto":options.preload===!1?this.sound.preload="none":this.sound.preload=options.preload,this.setVolume(options.volume),buzz.sounds.push(this)}},group:function(sounds){function fn(){var args=argsToArray(null,arguments),func=args.shift();for(var i=0;i<sounds.length;i++)sounds[i][func].apply(sounds[i],args)}function argsToArray(array,args){return array instanceof Array?array:Array.prototype.slice.call(args)}sounds=argsToArray(sounds,arguments),this.getSounds=function(){return sounds},this.add=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++)sounds.push(soundArray[a])},this.remove=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++)for(var i=0;i<sounds.length;i++)if(sounds[i]==soundArray[a]){delete sounds[i];break}},this.load=function(){return fn("load"),this},this.play=function(){return fn("play"),this},this.togglePlay=function(){return fn("togglePlay"),this},this.pause=function(time){return fn("pause",time),this},this.stop=function(){return fn("stop"),this},this.mute=function(){return fn("mute"),this},this.unmute=function(){return fn("unmute"),this},this.toggleMute=function(){return fn("toggleMute"),this},this.setVolume=function(volume){return fn("setVolume",volume),this},this.increaseVolume=function(value){return fn("increaseVolume",value),this},this.decreaseVolume=function(value){return fn("decreaseVolume",value),this},this.loop=function(){return fn("loop"),this},this.unloop=function(){return fn("unloop"),this},this.setTime=function(time){return fn("setTime",time),this},this.setduration=function(duration){return fn("setduration",duration),this},this.set=function(key,value){return fn("set",key,value),this},this.bind=function(type,func){return fn("bind",type,func),this},this.unbind=function(type){return fn("unbind",type),this},this.bindOnce=function(type,func){return fn("bindOnce",type,func),this},this.trigger=function(type){return fn("trigger",type),this},this.fade=function(from,to,duration,callback){return fn("fade",from,to,duration,callback),this},this.fadeIn=function(duration,callback){return fn("fadeIn",duration,callback),this},this.fadeOut=function(duration,callback){return fn("fadeOut",duration,callback),this}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return!!buzz.el.canPlayType},isOGGSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(time,withHours){var h,m,s;return h=Math.floor(time/3600),h=isNaN(h)?"--":h>=10?h:"0"+h,m=withHours?Math.floor(time/60%60):Math.floor(time/60),m=isNaN(m)?"--":m>=10?m:"0"+m,s=Math.floor(time%60),s=isNaN(s)?"--":s>=10?s:"0"+s,withHours?h+":"+m+":"+s:m+":"+s},fromTimer:function(time){var splits=time.toString().split(":");return splits&&splits.length==3&&(time=parseInt(splits[0],10)*3600+parseInt(splits[1],10)*60+parseInt(splits[2],10)),splits&&splits.length==2&&(time=parseInt(splits[0],10)*60+parseInt(splits[1],10)),time},toPercent:function(value,total,decimal){var r=Math.pow(10,decimal||0);return Math.round(value*100/total*r)/r},fromPercent:function(percent,total,decimal){var r=Math.pow(10,decimal||0);return Math.round(total/100*percent*r)/r}}